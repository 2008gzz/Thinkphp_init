<include file="Public/side" title="管理员列表" />

<div class="col-xs-9" role="main">

	<form action="__URL__/save" method="post" enctype="multipart/form-data" class="form-horizontal" role="form">
		<div class="row" id="my_img_box">
		  <div class="col-xs-2 col-md-2 my_img_list">
		  </div>
		  <div class="col-xs-2 col-md-2 my_img_list" id="js_img_div">
		    <a href="#" class="thumbnail">
		      <img src="__PUBLIC__/images/admin/default-avatar.gif" alt="...">
		      <span class="close my_image_del" title="点击删除图片">&times;</span>
		    </a>
		  </div>
		</div>
		  
		<div class="form-group ">
        	<label for="input-staff_num" class="col-sm-2 control-label">图片</label>
        	<div class="col-sm-8">
	        <input type="file" name="image_up"  class="btn" id="image_up" value="" title="<i class='glyphicon glyphicon-folder-open'></i> 上传图片" >
	        <input type="hidden" name="photo_id" value="">
	        </div>
      	</div>
	
		<div class="form-group">
			<label for="inputEmail3" class="col-sm-2 control-label">用户名</label>
			<div class="col-xs-4">
				<input type="text" name="adminname" class="form-control" id="email" placeholder="用户名">
			</div>
		</div>
		<div class="form-group">
			<label for="inputPassword3" class="col-sm-2 control-label">Password</label>
			<div class="col-xs-4">
				<input type="password" name="password" class="form-control" id="password" placeholder="Password">
			</div>
		</div>
		<div class="form-group">
			<label for="inputPassword3" class="col-sm-2 control-label">确认密码</label>
			<div class="col-xs-4">
				<input type="password" name="re_password" class="form-control" id="re_password" placeholder="Password">
			</div>
		</div>

		<div class="form-group">
			<div class="col-sm-offset-2 col-sm-10">
				<button type="submit" class="btn btn-default">保 存</button>
			</div>
		</div>
	</form>


</div>


<script type="text/javascript" charset="utf-8"  src="__PUBLIC__/js/admin/ajaxfileupload.js"></script>
<script type="text/javascript" charset="utf-8"  src="__PUBLIC__/js/admin/bootstrap-filestyle.min.js"></script>
<script type="text/javascript">
var a_id = '';
var domain = "";

$(function(){
	
	// 上传图片样式
	$('#image_up').bootstrapFileInput();
	// 上传图片
	var file_name = '0';
	$("body").on('change','.file-input-wrapper input[type=file]', function(e){
		e.preventDefault();
		var len = $(".my_img_list").length;
		if (len >= 5) {
			js_prompt('最多上传5张图片');
		} else {
			console.log($(".file-input-name").html());
			console.log(file_name);
			if ($(".file-input-name").length < 1 || $(".file-input-name").html() != file_name) {
				console.log('------------------');
				ajaxFileUpload('image');
				file_name = $(".file-input-name").html();
			}
		}
		return true;
	});
	
    // 删除图片
    $(".image_del").on('click','.file-input-name', function(e){
    	e.preventDefault();
		var obj = $(this);
		var p_obj = obj.parents('.js_img_list')
		var p_id = p_obj.attr('data-id');
    	var data = new Object();
    	data.p_id = p_id;
    	data.a_id = a_id;
    	var url = '__MODULE__/Common/del_img';
    	$.post(url, data, function(json){
    		if (json.info == 'ok') {
    			p_obj.remove();
    			// 拖动排序
    			$( "#js_img_list_div" ).sortable();
    		} else {
    			js_prompt(json.data);
    		}
    	}, 'json');
    });
	
	
});

// 图片上传
function ajaxFileUpload(up){
	$(".js_loading_"+up).ajaxStart(function(){
		$(this).show();
	}).ajaxComplete(function(){
		$(this).hide();
	});
	var url =  '__MODULE__/Common/upload_img';
	var my_file = up + '_up';
	var data = new Object();
	data.res_id = a_id;
	data.res_name = 'article_photo';
	data.my_file = my_file;
	data.is_ajax = 1;
	$.ajaxFileUpload({
		url: url,
		secureuri:false,
		fileElementId: my_file,
		dataType: 'json',
		data: data,
		success: function (json, status){
			console.log(json);
			if (json.info == 'ok') {
				$("#js_img_div").find('img').attr('src', json.data.path);
				$("input[name='photo_id']").attr('value', json.data.id);
				$("#image_up").attr('value', json.data.name);
			} else {
				js_prompt(json.data);
			}
		},
		error: function (data, status, e){
			console.log(e);
			js_prompt('上传出错了，请刷新后重试');
			//alert(e);
		}
	})
	return false;
}


function get_li_html(data){
	var html = '';
	var url = domain + 'Photo/get_photo?id='+data.id+'&w=190&h=190&t=thumb';
	html +='  <div class="col-xs-2 col-md-2 my_img_list" data-id="'+data.id+'">';
	html +='    <div class="thumbnail">';
	html +='      	<img src="'+url+'" title="'+data.photo_name+'">';
	html +='	  	<span class="close image_del" title="点击删除图片">&times;</span>';
	html +='    </div>';
	html +='  </div>';

	return html;
}
</script>

<include file="Public/footer" />